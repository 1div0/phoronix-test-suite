#!/bin/sh

#
#	Phoronix Test Suite
#	URLs: http://www.phoronix.com, http://www.phoronix-test-suite.com/
#	Copyright (C) 2008, Phoronix Media
#	Copyright (C) 2008, Michael Larabel
#	phoronix-test-suite: The Phoronix Test Suite is an extensible open-source testing platform for Linux.
#
#	This program is free software; you can redistribute it and/or modify
#	it under the terms of the GNU General Public License as published by
#	the Free Software Foundation; either version 3 of the License, or
#	(at your option) any later version.
#
#	This program is distributed in the hope that it will be useful,
#	but WITHOUT ANY WARRANTY; without even the implied warranty of
#	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
#	GNU General Public License for more details.
#
#	You should have received a copy of the GNU General Public License
#	along with this program. If not, see <http://www.gnu.org/licenses/>.
#

# Full path to root directory of the actual Phoronix Test Suite code
export PTS_DIR=`pwd`
CALL_DIR=`pwd`
OPTION_HANDLE=$1
OPTION_ARG=$2

if [ $PTS_DIR != `pwd` ]
then
	cd $PTS_DIR
fi

# Ensure the user is in the correct directory
if [ ! -f pts-core/pts-run-cmd.php ] || [ ! -f pts-core/pts-run-test.php ]
then
	cat <<'EOT'

To run the Phoronix Test Suite locally you must first change directories to phoronix-test-suite/ or install the program using the install-sh script. For support visit: http://www.phoronix-test-suite.com/

EOT
exit
fi

# Determine PHP binary location
if [ -x /usr/bin/php5 ] || [ -x /usr/local/bin/php5 ]
then
	export PHP_BIN="php5"
elif [ -x /usr/bin/php ] || [ -x /usr/local/bin/php ]
then
	export PHP_BIN="php"
elif [ -x /usr/php5/bin/php ]
then
	export PHP_BIN="/usr/php5/bin/php"
elif [ -x /usr/php/bin/php ]
then
	export PHP_BIN="/usr/php/bin/php"
else
	export PHP_BIN=""
fi

# Make sure PHP is installed
if [ "X$PHP_BIN" = "X" ]
then
	cat <<'EOT'

PHP5 CLI Must Be Installed To Run The Phoronix Test Suite.
Only PHP For The Command Line Is Needed, Not A Complete PHP w/ Web Server Installation
The PHP CLI package is usually called php-cli or php5-cli. Also required is the PHP GD library (php-gd)
For support visit: http://www.phoronix-test-suite.com/

EOT
exit
fi

# Check if being called from a Self Contained test profile
export SCTP_FILE=`echo $CALL_DIR/$1 | sed 's:\./::g'`
if [ -e $SCTP_FILE ]
then
	OPTION_HANDLE="benchmark"
	OPTION_ARG=$SCTP_FILE
fi

export PTS_COMMAND=$1
case "$1" in
"install" | "force-install")
	$PHP_BIN pts-core/pts-run-cmd.php INSTALL_TEST $OPTION_ARG
	;;
"install-dependencies")
	$PHP_BIN pts-core/pts-run-cmd.php INSTALL_EXTERNAL_DEPENDENCIES $OPTION_ARG
	;;
"install-all" | "force-install-all")
	$PHP_BIN pts-core/pts-run-cmd.php INSTALL_ALL
	;;
"run")
	$PHP_BIN pts-core/pts-run-test.php $OPTION_ARG
	;;
"batch-run")
	export PTS_BATCH_MODE=1
	$PHP_BIN pts-core/pts-run-test.php $OPTION_ARG
	;;
"benchmark")
	export SILENT_INSTALL=1
	$PHP_BIN pts-core/pts-run-cmd.php INSTALL_TEST $OPTION_ARG
	$PHP_BIN pts-core/pts-run-test.php $OPTION_ARG
	;;
"batch-benchmark")
	export PTS_BATCH_MODE=1
	export SILENT_INSTALL=1
	$PHP_BIN pts-core/pts-run-cmd.php INSTALL_TEST $OPTION_ARG
	$PHP_BIN pts-core/pts-run-test.php $OPTION_ARG
	;;
"merge-results")
	$PHP_BIN pts-core/pts-run-cmd.php MERGE_RESULTS $OPTION_ARG $3 $4
	;;
"analyze" | "analyze-results")
	$PHP_BIN pts-core/pts-run-cmd.php ANALYZE_RESULTS $OPTION_ARG $3
	;;
"remove-result")
	$PHP_BIN pts-core/pts-run-cmd.php REMOVE_RESULT $OPTION_ARG
	;;
"remove-installed-test")
	$PHP_BIN pts-core/pts-run-cmd.php REMOVE_INSTALLED_TEST $OPTION_ARG
	;;
"remove-all-results")
	$PHP_BIN pts-core/pts-run-cmd.php REMOVE_ALL_RESULTS
	;;
"upload" | "upload-result" | "upload-results" | "upload-saved-result")
	$PHP_BIN pts-core/pts-run-cmd.php UPLOAD_RESULT $OPTION_ARG
	;;
"make-download-cache")
	$PHP_BIN pts-core/pts-run-cmd.php MAKE_DOWNLOAD_CACHE
	;;
"list-tests" | "list-all-tests")
	$PHP_BIN pts-core/pts-run-cmd.php LIST_TESTS
	;;
"list-suites")
	$PHP_BIN pts-core/pts-run-cmd.php LIST_SUITES
	;;
"list-modules")
	$PHP_BIN pts-core/pts-run-cmd.php LIST_MODULES
	;;
"list-possible-dependencies")
	$PHP_BIN pts-core/pts-run-cmd.php LIST_POSSIBLE_EXTERNAL_DEPENDENCIES
	;;
"list-installed-tests")
	$PHP_BIN pts-core/pts-run-cmd.php LIST_INSTALLED_TESTS
	;;
"list-usage" | "list-test-usage")
	$PHP_BIN pts-core/pts-run-cmd.php LIST_TEST_USAGE
	;;
"list-results" | "list-saved-results" | "list-test-results")
	$PHP_BIN pts-core/pts-run-cmd.php LIST_SAVED_RESULTS
	;;
"result-info" | "results-info")
	$PHP_BIN pts-core/pts-run-cmd.php RESULT_INFO $OPTION_ARG
	;;
"show-result" | "show-results" | "view-result" | "view-results")
	$PHP_BIN pts-core/pts-run-cmd.php SHOW_RESULT $OPTION_ARG
	;;
"info" | "suite-info" | "test-info")
	$PHP_BIN pts-core/pts-run-cmd.php INFO $OPTION_ARG
	;;
"module-info")
	$PHP_BIN pts-core/pts-run-cmd.php MODULE_INFO $OPTION_ARG
	;;
"module-setup")
	$PHP_BIN pts-core/pts-run-cmd.php MODULE_SETUP $OPTION_ARG
	;;
"system-info" | "system-information")
	$PHP_BIN pts-core/pts-run-cmd.php SYS_INFO
	;;
"diagnostics")
	$PHP_BIN pts-core/pts-run-cmd.php DIAGNOSTICS_DUMP
	;;
"clone")
	$PHP_BIN pts-core/pts-run-cmd.php CLONE $OPTION_ARG
	;;
"initial-config")
	$PHP_BIN pts-core/pts-run-cmd.php INITIAL_CONFIG
	;;
"version")
	$PHP_BIN pts-core/pts-run-cmd.php VERSION
	;;
"login")
	$PHP_BIN pts-core/pts-run-cmd.php LOGIN
	;;
"batch-setup")
	$PHP_BIN pts-core/pts-run-cmd.php BATCH_SETUP
	;;
"refresh-graph" | "refresh-graphs" | "refresh-result")
	$PHP_BIN pts-core/pts-run-cmd.php REFRESH_GRAPHS $OPTION_ARG
	;;
"test-module" | "debug-module")
	if [ "$1" = "debug-module" ]
	then
		export PTS_DEBUG=1
	fi

	export PTS_IGNORE_MODULES=1
	$PHP_BIN pts-core/pts-run-cmd.php TEST_MODULE $OPTION_ARG
	;;
"sensors" | "sensor-options")
	echo "\nThis option was dropped from the Phoronix Test Suite. For more information and the replacement option, view the latest documentation.\n"
	;;
*)
	cat <<'EOT'

=================================
Phoronix Test Suite
URL: http://www.phoronix-test-suite.com/
=================================

Installation Options:
	install <suite / test>: Install or update the specified suite/test(s)
	install-dependencies <suite / test>: Install the external (distribution-level) dependencies
	install-all: Install or update all available tests
	list-installed-tests: List all tests that are installed

Testing Options:
	benchmark <suite / test / saved file / Global ID>: Install and then run the test(s)
	run <suite / test / saved file / Global ID>: Run the specified test(s)
	list-tests: List all tests and relevant information
	list-suites: List all suites and relevant information

Batch Testing Options:
	batch-setup: Setup the batch mode options
	batch-run <suite OR test>: Run the specified test(s) in batch mode
	batch-benchmark <suite OR test OR saved file>: Install and run the test(s) in batch mode
	analyze <suite / test / saved file / Global ID>: Provide an analysis of the results generated from a batch run

Result Viewing Options:
	list-results: List all saved results
	show-result <saved name>: Show this result file in your web browser
	remove-result <saved name>: Remove this saved result file
	remove-all-results: Removes all saved results
	merge-results <saved Name 1 / Global ID> <saved Name 2 / Global ID> <save name>: Merge two sets of results
	upload-results <saved name>: Upload a saved set of results to Phoronix Global
	login: Enter your Phoronix Global log-in information for uploading results

Module Options:
	list-modules: List all installed/available PTS modules
	module-info: Show detailed information on a PTS module
	module-setup: Configure the end-user options for a PTS module

Miscellaneous Options:
	make-download-cache: Backup all downloaded test files to ~/.phoronix-test-suite/download-cache/
	info <suite / test>: Show detailed information about a test or suite
	system-info: Show detected software and hardware information
	diagnostics: Useful information when reporting a bug or problem
	version: Print the Phoronix Test Suite version and code-name
EOT
	;;
esac

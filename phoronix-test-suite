#!/bin/sh

#
#	Phoronix Test Suite "Trondheim"
#	URLs: http://www.phoronix.com, http://www.phoronix-test-suite.com/
#	Copyright (C) 2008, Phoronix Media
#	Copyright (C) 2008, Michael Larabel
#	phoronix-test-suite: The Phoronix Test Suite is an extensible open-source testing platform for Linux.
#
#	This program is free software; you can redistribute it and/or modify
#	it under the terms of the GNU General Public License as published by
#	the Free Software Foundation; either version 3 of the License, or
#	(at your option) any later version.
#
#	This program is distributed in the hope that it will be useful,
#	but WITHOUT ANY WARRANTY; without even the implied warranty of
#	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
#	GNU General Public License for more details.
#
#	You should have received a copy of the GNU General Public License
#	along with this program. If not, see <http://www.gnu.org/licenses/>.
#

# Full path to root directory of the actual Phoronix Test Suite code
export PTS_DIR=`pwd`

if [ $PTS_DIR != `pwd` ]
then
	cd $PTS_DIR
fi

# Location to save results, download cache, results viewer, etc. Must have trailing slash.
export PTS_USER_DIR=$HOME'/.phoronix-test-suite/'

# Determine PHP binary location
if [ -x /usr/bin/php5 ] || [ -x /usr/local/bin/php5 ]
then
	export PHP_BIN="php5"
elif [ -x /usr/bin/php ] || [ -x /usr/local/bin/php ]
then
	export PHP_BIN="php"
else
	export PHP_BIN=""
fi

# Make sure PHP is installed
if [ "X$PHP_BIN" = "X" ]
then
	cat <<'EOT'

PHP5 CLI Must Be Installed To Run The Phoronix Test Suite!
Only PHP For The Command Line Is Needed, Not A Complete PHP w/ Web Server Installation
The PHP CLI package is usually called php-cli or php5-cli. Also required is the PHP GD library (php-gd)
For support visit: http://www.phoronix.com/forums/forumdisplay.php?f=49

EOT
exit
fi


case "$1" in
"install")
	$PHP_BIN pts-core/pts-run-cmd.php INSTALL_BENCHMARK $2
	;;
"force-install")
	$PHP_BIN pts-core/pts-run-cmd.php FORCE_INSTALL_BENCHMARK $2
	;;
"install-dependencies")
	$PHP_BIN pts-core/pts-run-cmd.php INSTALL_EXTERNAL_DEPENDENCIES $2
	;;
"install-all")
	$PHP_BIN pts-core/pts-run-cmd.php INSTALL_ALL
	;;
"force-install-all")
	$PHP_BIN pts-core/pts-run-cmd.php FORCE_INSTALL_ALL
	;;
"run")
	$PHP_BIN pts-core/pts-run-benchmark.php $2
	;;
"batch-run")
	$PHP_BIN pts-core/pts-run-benchmark.php $2 BATCH
	;;
"benchmark")
	export SILENT_INSTALL=1
	$PHP_BIN pts-core/pts-run-cmd.php INSTALL_BENCHMARK $2
	$PHP_BIN pts-core/pts-run-benchmark.php $2
	;;
"batch-benchmark")
	export SILENT_INSTALL=1
	$PHP_BIN pts-core/pts-run-cmd.php INSTALL_BENCHMARK $2
	$PHP_BIN pts-core/pts-run-benchmark.php $2 BATCH
	;;
"merge-results")
	$PHP_BIN pts-core/pts-run-cmd.php MERGE_RESULTS $2 $3 $4
	;;
"remove-result")
	$PHP_BIN pts-core/pts-run-cmd.php REMOVE_RESULT $2
	;;
"remove-all-results")
	$PHP_BIN pts-core/pts-run-cmd.php REMOVE_ALL_RESULTS
	;;
"upload")
	$PHP_BIN pts-core/pts-run-cmd.php UPLOAD_RESULT $2
	;;
"make-download-cache")
	$PHP_BIN pts-core/pts-run-cmd.php MAKE_DOWNLOAD_CACHE
	;;
"list-tests")
	$PHP_BIN pts-core/pts-run-cmd.php LIST_TESTS
	;;
"list-suites")
	$PHP_BIN pts-core/pts-run-cmd.php LIST_SUITES
	;;
"list-results" | "list-saved-results")
	$PHP_BIN pts-core/pts-run-cmd.php LIST_SAVED_RESULTS
	;;
"show-result")
	$PHP_BIN pts-core/pts-run-cmd.php SHOW_RESULT $2
	;;
"info" | "suite-info" | "suite-information" | "test-info" | "test-information")
	$PHP_BIN pts-core/pts-run-cmd.php INFO $2
	;;
"system-info" | "system-information")
	$PHP_BIN pts-core/pts-run-cmd.php SYS_INFO
	;;
"sensors")
	export MONITOR=all
	$PHP_BIN pts-core/pts-run-cmd.php SENSORS
	;;
"sensor-options")
	$PHP_BIN pts-core/pts-run-cmd.php SENSOR_OPTIONS
	;;
"diagnostics")
	$PHP_BIN pts-core/pts-run-cmd.php DIAGNOSTICS_DUMP
	;;
"initial-config")
	$PHP_BIN pts-core/pts-run-cmd.php INITIAL_CONFIG
	;;
"version")
	$PHP_BIN pts-core/pts-run-cmd.php VERSION
	;;
"login")
	$PHP_BIN pts-core/pts-run-cmd.php LOGIN
	;;
"batch-setup")
	$PHP_BIN pts-core/pts-run-cmd.php BATCH_SETUP
	;;
"refresh-graph" | "refresh-graphs")
	$PHP_BIN pts-core/pts-run-cmd.php REFRESH_GRAPHS $2
	;;
*)
	cat <<'EOT'

=================================
Phoronix Test Suite
http://www.phoronix-test-suite.com/
=================================

install <suite OR test>: Install or Update The Specified Test(s)
install-dependencies <suite OR test>: Install The External (Distribution) Dependencies For Specified Test(s)
install-all: Install or Update all available tests
run <suite OR test>: Run The Specified Test/Suite
batch-run <suite OR test>: Run The Specified Test/Suite in Batch Mode
benchmark <suite OR test OR saved file>: Same as manually running install and then run
batch-benchmark <suite OR test OR saved file>: Same as manually running install and then run in Batch Mode
batch-setup: Setup the batch mode options
merge-results <Saved File 1 OR Global ID> <Saved File 2 OR Global ID> <Save To>: Merge two saved result sets
list-tests: List all Phoronix Test Suite test profiles
list-suites: List all Phoronix Test Suites
list-results: List all saved results
make-download-cache: Backup all saved files to ~/.phoronix-test-suite/download-cache/
remove-result <Saved File>: Remove this saved result file and associated files
remove-all-results: Removes all saved results and associated files
info <suite OR test>: Show detailed information about a test or suite
system-info: Dump detected software and hardware information detected by PTS
sensor-options: Show system sensors that can be monitored through PTS
upload <Saved File>: Upload these results to be shared globally
show-result <Saved File>: Show this result file in your web browser
version: Report the Phoronix Test Suite version and code-name
login: Enter in your PTS Global log-in information for uploading results

EOT
	;;
esac
